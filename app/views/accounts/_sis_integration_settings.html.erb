<fieldset id="sis_integration_settings">
    <legend><%= t("SIS Integration Settings") %></legend>
    <div>
        <%= f.check_box :allow_sis_import, :checked => @account.allow_sis_import %>
        <%= f.label :allow_sis_import, t("SIS imports") %>
    </div>
    <%= f.fields_for :settings do |settings| %>
        <%= settings.fields_for :sis_syncing do |ff_syncing| %>
            <%
            sis_syncing = @account.sis_syncing
            sis_syncing_locked_subs = sis_syncing[:locked] && sis_syncing[:inherited]
            %>
            <div>
                <%= ff_syncing.check_box :value, :checked => sis_syncing[:value],
                    :disabled => sis_syncing_locked_subs,
                    "aria-controls" => "account_settings_sis_syncing_value_settings" %>
                <%= ff_syncing.label :value, t("SIS syncing") %>
            </div>
        <fieldset id="account_settings_sis_syncing_value_settings" class="nested" style="display: none;">
            <legend class="screenreader-only"><%= t("Additional settings for SIS syncing") %></legend>
            <div>
                <%= ff_syncing.check_box :locked, :checked => sis_syncing[:locked],
                    :disabled => sis_syncing_locked_subs %>
                <%= ff_syncing.label :locked, t("Lock this setting for sub-accounts") %>
            </div>
            <% if Assignment.sis_grade_export_enabled?(@account) %>
                <%= settings.fields_for :sis_default_grade_export do |ff_default| %>
                    <%
                    default_export = @account.sis_default_grade_export
                    default_disabled = sis_syncing_locked_subs ||
                        (default_export[:locked] && default_export[:inherited])
                    %>
                    <div>
                        <%= ff_default.check_box :value, :checked => default_export[:value],
                            :disabled => default_disabled %>
                        <%= ff_default.label :value, t("\"Post Grades to SIS\" checkbox is enabled by default for assignments, graded discussions, and quizzes") %>
                    </div>
                <% end %>
            <% end %>
        <% end %>
        </fieldset>
    <% end %>
</fieldset>

<%= render partial: 'sis_agent_token_auth', locals: { f: f } %>
